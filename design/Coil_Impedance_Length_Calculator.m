% This program calculates the impedance, length, and weight of a coil.
% Author: Enrique Mireles Gutierrez
% Date: 05/03/2019

%% Load Data
% Data taken from http://electronbunker.ca/eb/InductanceCalcML.html

% Assumes coil inner diameter is 10mm.

clc
clear all
close all

inductance_40_AWG_20 = [0.0037708, 0.0166419, 0.0413474, 0.0809044, 0.1385837, 0.2178849, 0.32251369999999996, 0.4563624, 0.6234915999999999, 0.8281138, 1.0745794000000002, 1.367363, 1.7110524, 2.1103375, 2.5700013, 3.094911, 3.6900106, 4.3603141999999995, 5.1108996, 5.9469027, 6.8735129, 7.895968, 9.0195507, 10.2495846, 11.5914308, 13.050485199999999, 14.6321756, 16.3419591, 18.18532, 20.1677678];
wire_length_40_AWG_20 = [1.31271, 2.73659, 4.2716199999999995, 5.91783, 7.67521, 9.54376, 11.52348, 13.61439, 15.81648, 18.12974, 20.5542, 23.089830000000003, 25.73666, 28.49467, 31.36386, 34.34425, 37.43583, 40.63858999999999, 43.95255, 47.3777, 50.91404, 54.56157, 58.32029, 62.19021, 66.17132000000001, 70.26361999999999, 74.46712, 78.78181, 83.2077, 87.74478];
coil_length_40_AWG_20 = 3.5409999999999995;
inductance_60_AWG_20 = [0.0058849, 0.0261182, 0.0652387, 0.12832069999999998, 0.22093700000000002, 0.3491262, 0.5193622, 0.7385254, 1.0138766000000001, 1.3530315, 1.7639379, 2.2548533, 2.8343253, 3.511172, 4.2944649, 5.193511900000001, 6.2178422, 7.377192, 8.681491099999999, 10.1408506, 11.765551199999999, 13.5660328, 15.552884, 17.7368332, 20.12874, 22.7395866, 25.5804708, 28.6625988, 31.9972788, 35.595914799999996];
wire_length_60_AWG_20 = [1.9690699999999999, 4.1048800000000005, 6.407439999999999, 8.87674, 11.51281, 14.31564, 17.28523, 20.421580000000002, 23.724709999999998, 27.19462, 30.83129, 34.63475, 38.604980000000005, 42.742, 47.0458, 51.51637, 56.15374, 60.95789, 65.92882, 71.06653999999999, 76.37105, 81.84235000000001, 87.48044, 93.28531, 99.25698, 105.39544000000001, 111.70067999999999, 118.17272, 124.81155, 131.61717000000002];
coil_length_60_AWG_20 = 5.311;
inductance_80_AWG_20 = [0.0080062, 0.0356351, 0.0892558, 0.1760388, 0.30391379999999996, 0.4815331, 0.7182360999999999, 1.0240155, 1.4094859, 1.8858526, 2.4648825999999997, 3.1588772, 3.9806454, 4.9434785, 6.0611266, 7.3477755, 8.8180254, 10.486870000000001, 12.3696774, 14.4821711, 16.8404132, 19.4607867, 22.359980800000002, 25.554975, 29.0630255, 32.9016515, 37.088622300000004, 41.6419456, 46.5798557, 51.9208027];
wire_length_80_AWG_20 = [2.6254299999999997, 5.47317, 8.54325, 11.83566, 15.35041, 19.087509999999998, 23.04697, 27.22878, 31.63295, 36.25949, 41.10839, 46.17967, 51.47331, 56.98933, 62.72773, 68.6885, 74.87164999999999, 81.27717999999999, 87.9051, 94.75539, 101.82807000000001, 109.12314, 116.64058, 124.38042, 132.34264000000002, 140.52725, 148.93424, 157.56363000000002, 166.4154, 175.48956];
coil_length_80_AWG_20 = 7.081999999999999;
inductance_100_AWG_20 = [0.0101304, 0.0451685, 0.1133245, 0.2238809, 0.3871479, 0.6144233, 0.9179544, 1.3109009, 1.8072995, 2.4220295999999997, 3.17078, 4.0700175, 5.1369559, 6.389526399999999, 7.8463493, 9.5267067, 11.450516, 13.6383049, 16.1111865, 18.8908367, 21.9994712, 25.459824400000002, 29.295128100000003, 33.5290925, 38.185886599999996, 43.2901199, 48.8668255, 54.941442699999996, 61.5398011, 68.6881055];
wire_length_100_AWG_20 = [3.2817800000000004, 6.84147, 10.67906, 14.79457, 19.18802, 23.859389999999998, 28.808709999999998, 34.03597, 39.54119, 45.32436, 51.38549, 57.72458, 64.34164, 71.23666, 78.40966, 85.86062, 93.58955999999999, 101.59648, 109.88136999999999, 118.44424000000001, 127.28509, 136.40392, 145.80073000000002, 155.47552, 165.42829999999998, 175.65906, 186.16781, 196.95454, 208.01925, 219.36195];
coil_length_100_AWG_20 = 8.852;
inductance_40_AWG_22 = [0.0046635, 0.0200851, 0.0487393, 0.09329689999999999, 0.1566032, 0.24166059999999998, 0.351613, 0.48973219999999995, 0.6594053, 0.8641239000000001, 1.1074741, 1.3931277, 1.7248343, 2.106414, 2.5417512, 3.0347885000000003, 3.589522, 4.209996299999999, 4.9003005, 5.6645642, 6.5069543, 7.4316719, 8.4429492, 9.5450476, 10.7422547, 12.0388827, 13.4392665, 14.9477617, 16.5687432, 18.306604];
wire_length_40_AWG_22 = [1.30103, 2.69023, 4.167590000000001, 5.7331199999999995, 7.386819999999999, 9.12869, 10.95874, 12.87695, 14.88334, 16.9779, 19.16064, 21.43156, 23.790650000000003, 26.23792, 28.77336, 31.396990000000002, 34.10879, 36.90877, 39.79693, 42.77327, 45.83779, 48.99049, 52.231370000000005, 55.560430000000004, 58.97768, 62.4831, 66.0767, 69.75849000000001, 73.52844999999999, 77.3866];
coil_length_40_AWG_22 = 2.808;
inductance_60_AWG_22 = [0.0073456, 0.0318107, 0.0775959, 0.14928999999999998, 0.2518409, 0.390532, 0.5709599, 0.7990132999999999, 1.0808541, 1.4228993, 1.8318041, 2.3144464, 2.8779124, 3.5294825999999997, 4.2766195, 5.1269555, 6.0882822999999995, 7.1685405, 8.37581, 9.718301199999999, 11.204347, 12.8423948, 14.6409995, 16.608817, 18.754597699999998, 21.087181100000002, 23.6154901, 26.348526200000002, 29.295365, 32.465151399999996];
wire_length_60_AWG_22 = [1.95155, 4.03534, 6.251390000000001, 8.599680000000001, 11.08023, 13.693040000000002, 16.4381, 19.31543, 22.32501, 25.46686, 28.740959999999998, 32.14734, 35.685970000000005, 39.35688, 43.160050000000005, 47.09548, 51.16319, 55.36316, 59.6954, 64.15991, 68.75669, 73.48574, 78.34706, 83.34065, 88.46651, 93.72465, 99.11505, 104.63772999999999, 110.29267999999999, 116.0799];
coil_length_60_AWG_22 = 4.212;
inductance_80_AWG_22 = [0.0100418, 0.0436105, 0.1066685, 0.20577199999999998, 0.3480385, 0.5411187, 0.7931699999999999, 1.1128314000000001, 1.5092001, 1.9918080999999999, 2.5706014, 3.255919, 4.0584737, 4.9893333, 6.0599031000000005, 7.2819091, 8.6673822, 10.228643, 11.978287700000001, 13.929174100000001, 16.094409, 18.4873361, 21.121524, 24.0107557, 27.1690177, 30.610490600000002, 34.349539400000005, 38.4007048, 42.7786948, 47.4983766];
wire_length_80_AWG_22 = [2.60206, 5.38046, 8.335180000000001, 11.466239999999999, 14.773639999999999, 18.25739, 21.91747, 25.7539, 29.76668, 33.95581, 38.32129, 42.86312, 47.581300000000006, 52.47584, 57.546730000000004, 62.793980000000005, 68.21758, 73.81754, 79.59387, 85.54655, 91.67559, 97.98099, 104.46275, 111.12087, 117.95535000000001, 124.9662, 132.1534, 139.51697000000001, 147.05689999999998, 154.7732];
coil_length_80_AWG_22 = 5.615;
inductance_100_AWG_22 = [0.0127438, 0.055440800000000005, 0.13583009999999998, 0.2624568, 0.4446363, 0.6924242, 1.0165869, 1.4285736, 1.9404897, 2.5650707, 3.3156574, 4.206172, 5.2510952, 6.4654435, 7.8647485999999995, 9.4650364, 11.2828074, 13.3350179, 15.639061700000001, 18.212752599999998, 21.074308000000002, 24.2423324, 27.735802, 31.5740503, 35.7767536, 40.363917300000004, 45.3558632, 50.7732168, 56.6368953, 62.9680962];
wire_length_100_AWG_22 = [3.25258, 6.725569999999999, 10.41898, 14.33281, 18.46706, 22.82173, 27.39684, 32.19238, 37.208349999999996, 42.44476, 47.90161, 53.57889, 59.476620000000004, 65.59478999999999, 71.93341000000001, 78.49247, 85.27198, 92.27193, 99.49233, 106.93318, 114.59447999999999, 122.47623, 130.57843, 138.90107999999998, 147.44419, 156.20774, 165.19175, 174.39621, 183.82113, 193.4665];
coil_length_100_AWG_22 = 7.019;
labels_inductances = {'40 Turns | 20 AWG | 3.5cm', '60 Turns | 20 AWG | 5.3cm', '80 Turns | 20 AWG | 7.1cm', '100 Turns | 20 AWG | 8.9cm', '40 Turns | 22 AWG | 2.8cm', '60 Turns | 22 AWG | 4.2cm', '80 Turns | 22 AWG | 5.6cm', '100 Turns | 22 AWG | 7.0cm'};
inductances = [inductance_40_AWG_20; inductance_60_AWG_20; inductance_80_AWG_20; inductance_100_AWG_20; inductance_40_AWG_22; inductance_60_AWG_22; inductance_80_AWG_22; inductance_100_AWG_22];
wire_lengths = [wire_length_40_AWG_20; wire_length_60_AWG_20; wire_length_80_AWG_20; wire_length_100_AWG_20; wire_length_40_AWG_22; wire_length_60_AWG_22; wire_length_80_AWG_22; wire_length_100_AWG_22];
layers = 1:1:30;

%% Plot data
close all
clc

% Plot all inductances vs. number of layer.
figure(1);
for idx = 1:size(inductances, 1)
    plot(layers, inductances(idx,:), '-');
    hold all;
    grid on; 
end
title('Relationship between layers and inductance (D = 10mm)');
xlabel('Number of Layers');
ylabel('Inductance L (mH)');
lgd = legend(labels_inductances);

% Plot selected point.
plot(24, inductance_80_AWG_22(24), '*r');

% Plot all wire lengths vs. number of layer.
figure(2);
for idx = 1:size(wire_lengths, 1)
    plot(layers, wire_lengths(idx,:), '-');
    hold all;
    grid on; 
end
title('Relationship between layers and wire length (D = 10mm)');
xlabel('Number of Layers');
ylabel('Wire Length [m]');
lgd = legend(labels_inductances);

% Plot selected point.
plot(24, wire_length_80_AWG_22(24), '*r');

%% Calculate the impedance of the coil at the desired frequency.
clc

% Inductance of the coil [H]
% (CHANGE THIS VALUE ACCORDINGLY).
inductance = 0.02401;

% Wire length of the coil in [m]
% (CHANGE THIS VALUE ACCORDINGLY).
wire_length  = 111.1;

% Frequency operation range
freq = linspace(0, 100, 100);

% Conversion factors
MM2_TO_M2 = 1e-6;

% Resistivity at 20°C [ohm m]
% http://hyperphysics.phy-astr.gsu.edu/hbase/Tables/wirega.html
resistivity = 1.724e-8;

% Diameter from 20 - 30 AWG in mm
% http://diyaudioprojects.com/Technical/American-Wire-Gauge/
label_AWG = {'20 AWG', '22 AWG', '24 AWG', '26 AWG'};
diameter_AWG = [0.8128, 0.64516, 0.51054, 0.4038];

% Mass of wire in [kg/m]
% https://en.wikibooks.org/wiki/Engineering_Tables/Standard_Wire_Gauge
copper_mass_per_length = [0.00586, 0.00354, 0.00219, 0.00146];
wire_weight = wire_length .* copper_mass_per_length .* 1000;

% Combine labels_AWG and wire_weight
labels = {};
for idx = 1:size(label_AWG, 2)
    labels(idx) = strcat(label_AWG(idx), {' | m = '}, num2str(wire_weight(idx), '%0.f'), {'g'});
end

% Area of the wire in mm2
area_AWG = (diameter_AWG/2).^ 2 .* pi;

% Resitance of every wire type in [ohms]
resistance = resistivity * wire_length ./ (area_AWG .* MM2_TO_M2);

% Reactance of the coil [ohm]
reactance = 2 * pi .* freq * inductance;

% Plot total impedance of the coil [ohm]
figure(3);
for idx = 1:numel(resistance)
    r = resistance(idx);
    z = reactance + r;
    plot(freq, z);
    xlabel('Frequency [Hz]');
    ylabel('Impedance Z [ohm]');
    hold on;
end
grid on;
legend(labels);
title(strcat({'Impedance of Coil | l = '}, num2str(wire_length), {'m | L = '}, num2str(inductance), {'H'}));

% Plot desired operation point
plot(20, resistance(2) + reactance(20), '*r');